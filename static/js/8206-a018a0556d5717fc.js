(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8206],{56178:function(t,e,n){"use strict";n.d(e,{hh:function(){return P}}),(s=l||(l={})).Release="release",s.Beta="beta",s.Test="test";let r={[l.Release]:"//meepo.meitustat.com/ab_allot_web_v2",[l.Beta]:"//test-meepo.meitustat.com/ab_allot_web_v2",[l.Test]:"//test-meepo.meitustat.com/ab_allot_web_v2"},o="[@meitu/ab-test]";(u=f||(f={}))[u.Created=0]="Created",u[u.InProgress=1]="InProgress",u[u.Completed=2]="Completed",u[u.Terminated=3]="Terminated",u[u.Publish=4]="Publish",u[u.Published=5]="Published",u[u.End=6]="End",(c=d||(d={}))[c.Client=1]="Client",c[c.ClientLocal=2]="ClientLocal",c[c.Server=3]="Server",c[c.AsyncCommon=4]="AsyncCommon",c[c.AsyncPush=5]="AsyncPush",c[c.AsyncRecommend=6]="AsyncRecommend",(a=p||(p={})).Uid="type1",a.AppGid="type2",a.WebGid="type3",a.PcGid="type4",a.MacAddress="type5";class i{constructor(t){this.options={appKey:"",gid:"",wgid:"",custom:[],env:l.Release},this.initialize=!1,this.options=Object.assign(Object.assign({},this.options),t)}get version(){return"1.2.0"}get env(){return this.options.env||l.Release}get url(){return r[this.env]}get custom(){var t,e;return null!==(e=null===(t=this.options)||void 0===t?void 0:t.custom)&&void 0!==e?e:[]}}var s,u,c,a,l,f,d,p,b=n(97582),y=n(37166);n(11865);var h=n(68929),v=n.n(h),m=n(4942),g=n(68630),O=n.n(g),w=n(23129);let S="abTest";class P extends i{get identifyMap(){return this.custom.reduce((t,e)=>{let{type:n,value:r}=e;return t[n]=r,t},{})}get wgid(){var t,e;let n="";try{n=null===(t=window.mtstat)||void 0===t?void 0:t.getDeviceId()}catch(r){console.warn(r)}return((null===(e=this.identifyMap)||void 0===e?void 0:e[p.WebGid])||n)+""}get abCodes(){return(0,y.l)(S,[])}get abCodesMap(){return this.abCodes.reduce((t,e)=>(t[e.abCode]=e,t),{})}init(){return(0,b.mG)(this,void 0,void 0,function*(){let t=[];if(window.mtstat&&"function"==typeof window.mtstat.init&&this.wgid){try{let e=yield this.fetchABCodes();t=e.abCodes.map(t=>(t.count=(null==t?void 0:t.count)||0,t))}catch(n){console.error(n)}this._setLocalABInfo(t),this.initialize=!0}else console.warn(o,"请确保先引入埋点统计 JS SDK（@meitu/mtstat-sdk），并调用 mtstat.init() 初始化之后，再进行 ABTest SDK 的初始化");return t})}fetchABCodes(){if("undefined"==typeof fetch)throw Error("Fetch API undefined");let t=this.toQueryParams(),e=function(t){let e="";for(let n=0;n<t.length;n++)e+=t.charCodeAt(n).toString(16);return e.toUpperCase()}(JSON.stringify(t));return new Promise((t,n)=>{null==fetch||fetch(this.url,{method:"POST",body:e}).then(e=>(0,b.mG)(this,void 0,void 0,function*(){let n=yield e.json();t(function t(e,n){return O()(n)?Object.keys(n).reduce(function(r,o){return Object.assign(r,(0,m.Z)({},e(o),t(e,n[o])))},{}):Array.isArray(n)?n.map(t.bind(null,e)):n}(v(),n))})).catch(t=>n(t))})}toQueryParams(){let{identifyMap:t}=this,{appKey:e,gid:n,uid:r}=this.options,i={appKey:e,[p.WebGid]:this.wgid,version:3};return n&&(i[p.AppGid]=n,console.warn(o,"uid 将在未来的版本中废弃，请使用 `custom` 来自定义标识类型")),r&&(i[p.Uid]=r,console.warn(o,"uid 将在未来的版本中废弃，请使用 `custom` 来自定义标识类型")),Object.assign(Object.assign({},i),t)}isInABTesting(t){var e,n;if(!this._checkHasInit("isInABTesting"))return!1;let r=this.abCodes,o=r.findIndex(({abCode:e})=>e===t);if(o>=0){let i=(null===(e=r[o])||void 0===e?void 0:e.count)||0;if(0===i){let s=(null===(n=r[o])||void 0===n?void 0:n.abCode)||0;s&&this.reportABCodeEnterTest(s)}return r[o].count+=1,(0,w.D)(S,r),!0}return!1}inABTestingCode(t){if(!this._checkHasInit("inABTestingCode"))return 0;let e=this.abCodesMap,n=t.find(t=>e[t]);return n&&this.isInABTesting(n),n||0}getABTestingServerCodes(){if(!this._checkHasInit("getABTestingServerCodes"))return[];let t=this.abCodes;return t.reduce((t,e)=>{let{abCode:n,et:r}=e,o=[d.Server,d.AsyncCommon,d.AsyncPush,d.AsyncRecommend];return o.indexOf(r)>=0&&t.push(n),t},[])}setABTestingServerCodes(t){this._checkHasInit("setABTestingServerCodes")&&t.forEach(t=>{this.isInABTesting(t)})}getABTestingCodes(){if(!this._checkHasInit("getABTestingCodes"))return[];let t=this.abCodes;return t.reduce((t,e)=>{let{abCode:n,status:r}=e;return r===f.InProgress&&t.push(n),t},[])}_setLocalABInfo(t=[]){let e=this.abCodesMap,n=t.map(({abCode:t,et:n,status:r,v:o})=>{let i=(null==e?void 0:e[t])||{},s=(null==i?void 0:i.v)===o&&i.count||0;return{abCode:t,et:n,status:r,v:o,count:s}});(0,w.D)(S,n)}reportABCodeEnterTest(t){var e;this._checkHasInit("reportABCodeEnterTest")&&(null===(e=window.mtstat)||void 0===e||e.track("abcode_enter_test",{current_abcode:t}))}_checkHasInit(t="该"){return this.initialize||console.warn(o,`尚未初始化成功，请确保初始化完毕再调用 【${t}】 方法`),this.initialize}getABInfo(){let t=this.abCodes.reduce((t,{abCode:e,status:n,count:r})=>(n===f.InProgress&&t.push({code:e,count:r}),t),[]);return{ab_codes:t,version:this.version}}}},37166:function(t,e,n){"use strict";function r(t,e){return function(t,e,n){try{var r=t.getItem(e),o=null==r?null:JSON.parse(r);return null!=o?o:n}catch(i){return n}}(localStorage,t,e)}n.d(e,{l:function(){return r}})},23129:function(t,e,n){"use strict";function r(t,e){!function(t,e,n){t.setItem(e,JSON.stringify(void 0===n?null:n))}(localStorage,t,e)}n.d(e,{D:function(){return r}})},85924:function(t,e,n){var r=n(5569)(Object.getPrototypeOf,Object);t.exports=r},5569:function(t){t.exports=function(t,e){return function(n){return t(e(n))}}},68630:function(t,e,n){var r=n(44239),o=n(85924),i=n(37005),s=Object.prototype,u=Function.prototype.toString,c=s.hasOwnProperty,a=u.call(Object);t.exports=function(t){if(!i(t)||"[object Object]"!=r(t))return!1;var e=o(t);if(null===e)return!0;var n=c.call(e,"constructor")&&e.constructor;return"function"==typeof n&&n instanceof n&&u.call(n)==a}},11865:function(t,e,n){var r=n(35393)(function(t,e,n){return t+(n?"_":"")+e.toLowerCase()});t.exports=r},97303:function(t,e,n){"use strict";n.d(e,{BD:function(){return d},ZR:function(){return h},iE:function(){return b},v6:function(){return y}});var r,o=n(1798),i=n.n(o),s=n(67294);function u(t){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function c(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function a(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function l(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?a(Object(n),!0).forEach(function(e){var r,o,i;r=t,o=e,i=n[e],(o=function(t){var e=function(t,e){if("object"!==u(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!==u(r))return r;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===u(e)?e:String(e)}(o))in r?Object.defineProperty(r,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[o]=i}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}var f="xdesign-widgets__config-update-event",d=((r={}).dev="dev",r.pre="pre",r.beta="beta",r.release="release",r),p={theme:"light",env:d.release,client_id:"",gid:"",device_id:"",channel:"",country_code:"",app_key:"",module_id:"",silent_token_key:"access_token"},b=function(){return l({},p)},y=function(t,e){p[t]=e,"env"===t&&e===d.dev&&(p.env=d.pre),i().publish(f)},h=function(){var t,e=function(t){if(Array.isArray(t))return t}(t=(0,s.useState)(p))||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i,s,u=[],c=!0,a=!1;try{if(i=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=i.call(n)).done)&&(u.push(r.value),u.length!==e);c=!0);}catch(l){a=!0,o=l}finally{try{if(!c&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(a)throw o}}return u}}(t,2)||function(t,e){if(t){if("string"==typeof t)return c(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if("Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return c(t,e)}}(t,2)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),n=e[0],r=e[1];return(0,s.useEffect)(function(){var t=function(){r(l({},p))};return i().subscribe(f,t),function(){i().unsubscribe(t)}},[]),n}},1798:function(t,e,n){var r,o,i;t=n.nmd(t),r="object"==typeof window&&window||this,o=function(t){"use strict";var e={},n=-1;function r(t,e,n){try{t(e,n)}catch(r){setTimeout(function(){throw r},0)}}function o(t,e,n){t(e,n)}function i(t,n,i,s){var u,c=e[n],a=s?o:r;if(Object.prototype.hasOwnProperty.call(e,n))for(u in c)Object.prototype.hasOwnProperty.call(c,u)&&a(c[u],t,i)}function s(t){var n=String(t);return Boolean(Object.prototype.hasOwnProperty.call(e,n)&&function(t){var e;for(e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!0;return!1}(e[n]))}function u(t,e,n,r){var o,u=(o=t="symbol"==typeof t?t.toString():t,function(){var t=String(o),n=t.lastIndexOf(".");for(i(o,o,e,r);-1!==n;)n=(t=t.substr(0,n)).lastIndexOf("."),i(o,t,e,r);i(o,"*",e,r)});return!!function(t){for(var e=String(t),n=s(e)||s("*"),r=e.lastIndexOf(".");!n&&-1!==r;)r=(e=e.substr(0,r)).lastIndexOf("."),n=s(e);return n}(t)&&(!0===n?u():setTimeout(u,0),!0)}t.publish=function(e,n){return u(e,n,!1,t.immediateExceptions)},t.publishSync=function(e,n){return u(e,n,!0,t.immediateExceptions)},t.subscribe=function(t,r){if("function"!=typeof r)return!1;t="symbol"==typeof t?t.toString():t,Object.prototype.hasOwnProperty.call(e,t)||(e[t]={});var o="uid_"+String(++n);return e[t][o]=r,o},t.subscribeAll=function(e){return t.subscribe("*",e)},t.subscribeOnce=function(e,n){var r=t.subscribe(e,function(){t.unsubscribe(r),n.apply(this,arguments)});return t},t.clearAllSubscriptions=function(){e={}},t.clearSubscriptions=function(t){var n;for(n in e)Object.prototype.hasOwnProperty.call(e,n)&&0===n.indexOf(t)&&delete e[n]},t.countSubscriptions=function(t){var n,r,o=0;for(n in e)if(Object.prototype.hasOwnProperty.call(e,n)&&0===n.indexOf(t)){for(r in e[n])o++;break}return o},t.getSubscriptions=function(t){var n,r=[];for(n in e)Object.prototype.hasOwnProperty.call(e,n)&&0===n.indexOf(t)&&r.push(n);return r},t.unsubscribe=function(n){var r,o,i,s="string"==typeof n&&(Object.prototype.hasOwnProperty.call(e,n)||function(t){var n;for(n in e)if(Object.prototype.hasOwnProperty.call(e,n)&&0===n.indexOf(t))return!0;return!1}(n)),u=!s&&"string"==typeof n,c="function"==typeof n,a=!1;if(s){t.clearSubscriptions(n);return}for(r in e)if(Object.prototype.hasOwnProperty.call(e,r)){if(o=e[r],u&&o[n]){delete o[n],a=n;break}if(c)for(i in o)Object.prototype.hasOwnProperty.call(o,i)&&o[i]===n&&(delete o[i],a=!0)}return a}},i={},r.PubSub?(i=r.PubSub,console.warn("PubSub already loaded, using existing version")):(r.PubSub=i,o(i)),void 0!==t&&t.exports&&(e=t.exports=i),e.PubSub=i,t.exports=e=i}}]);